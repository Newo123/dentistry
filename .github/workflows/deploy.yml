# name: Deploy to TimeWeb

# on:
#   push:
#     branches: [main]

# jobs:
#   deploy:
#     runs-on: ubuntu-latest

#     steps:
#       - name: üì• Checkout code
#         uses: actions/checkout@v4

#       - name: üü¢ Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: '20'
#           cache: 'npm'

#       - name: üì¶ Install dependencies
#         run: npm ci

#       - name: üèóÔ∏è Build project
#         run: npm run build

#       - name: üîë Setup SSH
#         run: |
#           mkdir -p ~/.ssh
#           chmod 700 ~/.ssh

#           echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
#           chmod 600 ~/.ssh/id_rsa
#           ssh-keyscan -H ${{ secrets.SSH_HOST }} >> ~/.ssh/known_hosts
#           chmod 644 ~/.ssh/known_hosts
#       - name: üöÄ Deploy
#         run: |
#           rsync -avz ./ ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }}:/public_html/

name: Deploy

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4

      - name: üü¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '24'
          cache: 'npm'

      - name: üì¶ Install dependencies
        run: npm ci

      - name: üèóÔ∏è Build project
        run: npm run build

      - name: üöÄ Deploy
        uses: easingthemes/ssh-deploy@v2.2.11
        with:
          # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
          REMOTE_HOST: ${{ secrets.SSH_HOST }}
          REMOTE_USER: ${{ secrets.SSH_USER }}
          TARGET: /public_html/
          SOURCE: ./

          # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
          ARGS: '-avzr'
          SCRIPT_BEFORE: |
            echo "–ù–∞—á–∏–Ω–∞–µ–º –¥–µ–ø–ª–æ–π –Ω–∞ $(date)"
          SCRIPT_AFTER: |
            echo "–î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
            echo "–û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞..."
